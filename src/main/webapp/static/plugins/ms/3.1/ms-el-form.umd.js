(function(c,v){typeof exports=="object"&&typeof module<"u"?v(exports,require("axios"),require("vue"),require("vue3-sfc-loader"),require("element-plus")):typeof define=="function"&&define.amd?define(["exports","axios","vue","vue3-sfc-loader","element-plus"],v):(c=typeof globalThis<"u"?globalThis:c||self,v(c.MsElForm={},c.axios,c.Vue,c.vue3SfcLoader))})(this,function(c,v,e,Y){"use strict";function M(a){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const n in a)if(n!=="default"){const s=Object.getOwnPropertyDescriptor(a,n);Object.defineProperty(l,n,s.get?s:{enumerable:!0,get:()=>a[n]})}}return l.default=a,Object.freeze(l)}const L=M(e),W="",w=(a,l)=>{const n=a.__vccOpts||a;for(const[s,r]of l)n[s]=r;return n},O={name:"ms-icon",props:["value"],data:function(){return{dialogVisible:!1,icons:[],mark:-1}},methods:{openIconList:function(){this.dialogVisible=!0},selected:function(a,l){this.$emit("update:value","icon-"+a),this.mark=l},select:function(){this.dialogVisible=!1},iconList:function(){var a=this;v.create().get(ms.base+"/static/plugins/iconfont/1.0.0/iconfont.json",{}).then(function(l){a.icons=l.data.glyphs}).catch(function(l){})}},created:function(){this.iconList()}},z={class:"list"},S=["onClick"];function $(a,l,n,s,r,i){const m=e.resolveComponent("el-button"),d=e.resolveComponent("el-input"),p=e.resolveComponent("el-scrollbar"),f=e.resolveComponent("el-main"),h=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(d,{modelValue:n.value,disabled:""},{prepend:e.withCtx(()=>[e.createElementVNode("i",{style:{"line-height":"1"},class:e.normalizeClass(["iconfont",n.value])},null,2)]),append:e.withCtx(()=>[e.createVNode(m,{class:"el-icon-search",onClick:i.openIconList},null,8,["onClick"])]),_:1},8,["modelValue"]),e.createVNode(h,{title:"选择图标",modelValue:a.dialogVisible,"onUpdate:modelValue":l[1]||(l[1]=u=>a.dialogVisible=u),width:"80%",class:"ms-Icons","close-on-click-modal":!1,"append-to-body":""},{footer:e.withCtx(()=>[e.createElementVNode("div",null,[e.createVNode(m,{size:"default",onClick:l[0]||(l[0]=u=>a.dialogVisible=!1)},{default:e.withCtx(()=>[e.createTextVNode("取 消")]),_:1}),e.createVNode(m,{size:"default",type:"primary",onClick:i.select},{default:e.withCtx(()=>[e.createTextVNode("确 定")]),_:1},8,["onClick"])])]),default:e.withCtx(()=>[e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(p,{style:{height:"100%"}},{default:e.withCtx(()=>[e.createElementVNode("div",z,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.icons,(u,y)=>(e.openBlock(),e.createElementBlock("div",{key:y,class:e.normalizeClass(a.mark==y?"select":""),onClick:B=>i.selected(u.font_class,y)},[e.createElementVNode("i",{class:e.normalizeClass(["iconfont","icon-"+u.font_class])},null,2),e.createTextVNode("icon-"+e.toDisplayString(u.font_class),1)],10,S))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const k=w(O,[["render",$],["__scopeId","data-v-15364228"]]),G="",D={props:{modelName:String,modelId:String,id:String,type:"",disabled:!1},name:"ms-mdiy-form",data:function(){return{loading:!1,modelComp:null,searchJson:null,mdiyForm:{update:{url:ms.manager+"/mdiy/form/data/update.do",params:{}},save:{url:ms.manager+"/mdiy/form/data/save.do",params:{}},get:{url:ms.manager+"/mdiy/form/data/getData.do",params:{}},modelUrl:ms.manager+"/mdiy/form/get.do"},mdiyConfig:{update:{url:ms.manager+"/mdiy/config/data/update.do",params:{}},save:{url:ms.manager+"/mdiy/config/data/update.do",params:{}},get:{url:ms.manager+"/mdiy/config/data/get.do",params:{}},modelUrl:ms.manager+"/mdiy/config/get.do"},mdiyModel:{update:{url:ms.manager+"/mdiy/model/data/update.do",params:{}},save:{url:ms.manager+"/mdiy/model/data/save.do",params:{}},get:{url:ms.manager+"/mdiy/model/data.do",params:{}},modelUrl:ms.manager+"/mdiy/model/get.do"},mdiyTag:{update:{url:ms.manager+"/mdiy/tag/globalTag/update.do",params:{}},save:{url:ms.manager+"/mdiy/tag/globalTag/update.do",params:{}},get:{url:ms.manager+"/mdiy/tag/globalTag/get.do",params:{}},modelUrl:ms.manager+"/mdiy/tag/globalTag/getModel.do"},qa:{update:{url:ms.manager+"/qa/data/update.do",params:{}},save:{url:ms.manager+"/qa/data/save.do",params:{}},get:{url:ms.manager+"/qa/data/getData.do",params:{}},modelUrl:ms.manager+"/qa/qa/get.do"},leaderbox:{update:{url:"/mdiy/model/data/update.do",params:{}},save:{url:"/mdiy/model/data/save.do",params:{}},get:{url:"/mdiy/model/data.do",params:{}},modelUrl:ms.manager+"/leader/box/model/get.do"},formURL:null}},watch:{modelId:function(a){this.render()}},methods:{getForm:function(){return this.$refs.form},render:function(){let a=this;a.loading=!0,a.type==="form"?this.formURL=this.mdiyForm:a.type==="config"?this.formURL=this.mdiyConfig:a.type==="model"?this.formURL=this.mdiyModel:a.type==="tag"?this.formURL=this.mdiyTag:a.type==="qa"?this.formURL=this.qa:a.type==="leaderbox"&&(this.formURL=this.leaderbox);const l=n=>{try{const s={moduleCache:{vue:L},async getFile(){return n},addStyle(i){const m=Object.assign(document.createElement("style"),{textContent:i}),d=document.head.getElementsByTagName("style")[0]||null;document.head.insertBefore(m,d)}},r=e.defineAsyncComponent(()=>Y.loadModule("modelComp.vue",s));a.modelComp=e.shallowRef(r),a.loading=!1}catch{}};ms.http.get(this.formURL.modelUrl,{id:this.modelId,modelName:this.modelName}).then(function(n){if(n.result&&n.data){var s=JSON.parse(n.data.modelJson);s.searchJson=s.searchJson.replace(/,\s*]/g,"]"),a.searchJson=JSON.parse(s.searchJson);var s=JSON.parse(n.data.modelJson),r=s.html,i="";s.script&&(i="<script>"+s.script.replace(`\r
});\r
`,`\r
}`)+"<\/script>");let m=r+i;m=m.replace('var custom_model = Vue.component("custom-model",{',"export default{"),m=m.replace("el: '#custom-model',",""),a.formURL.get.params=Object.assign({id:a.id,linkId:a.id},a.formURL.get.params),!a.id&&a.type!="config"&&a.type!="tag"&&(m=m.replace("that.get();","")),m=m.replace(/\}\);\s*<\/script>/,"};<\/script>"),m=m.replace("save:function(callback) {","save:function(callback) { debugger;"),m=m.replace("modelId:0,","formURL:"+JSON.stringify(a.formURL)+`,
 modelId:'`+n.data.id+"',"),a.disabled&&(m=m.replace("disabled:false,","disabled:"+a.disabled+",")),window.ms.debug,l(m)}else alert(n.msg)})}},created:function(){this.modelName&&(ms.manager=""),this.render()}},E={style:{height:"100%"}};function I(a,l,n,s,r,i){const m=e.resolveDirective("loading");return e.withDirectives((e.openBlock(),e.createElementBlock("div",E,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(a.modelComp),{ref:"form"},null,512))])),[[m,a.loading]])}const b=w(D,[["render",I],["__scopeId","data-v-bca7998a"]]),Q="",q={name:"ms-search",props:{isModel:{type:Boolean,default:!1},searchJson:{type:Array,default:[]},searchKey:{type:String}},inject:["searchParent"],computed:{$searchParent:function(){return this.isModel?this.searchParent.$refs.modelForm.$refs.form:this.searchParent},availableOptions(){var a=this;return a.searchJson.filter(function(l,n){return a.selectedList.indexOf(n)===-1})}},watch:{visible:function(a){var s;var l=!1;if(sessionStorage.getItem(this.searchKey))try{var n=JSON.parse(sessionStorage.getItem(this.searchKey));l=((s=n.form)==null?void 0:s.sqlWhere)!==void 0}catch{}a&&!l&&(this.list=[],this.selectedList=[])}},data:function(){return{visible:!1,list:[],selectedList:[]}},methods:{delField:function(a){this.list.splice(a,1),this.selectedList.splice(a,1)},select:function(a){var l=this.availableOptions[a];this.list.push(Object.assign({},l,{value:l.type==="switch"?!1:""}));var n=this.searchJson.findIndex(function(s){return s===l});this.selectedList.push(n)},dateChange:function(a){a.el==="range"?a.value=[]:Array.isArray(a.value)&&(a.value=a.value[0])},cascaderTreeDatas:function(a){return ms.util.treeData(this.$searchParent[a.model+"Options"],this.$searchParent[a.model+"Props"].value,a.extend.parentId,"children")},search:function(){var a=this;this.visible=!1;var l=[];let n=JSON.parse(JSON.stringify(a.list));for(var s=0;s<n.length;s++){var r=n[s];if(r.el==="empty"||r.el==="notempty"){r.value="",l.push(r);continue}if(!(!r.value||r.value.length===0))switch(r.type){case"province_id":r.value.forEach((f,h)=>{var u;h===0?u=r.field:u=r.attachFields[h-1],l.push({action:"and",field:u,el:"eq",value:f,type:"province_id"})});continue;case"checkbox":case"select":if(r.multiple){for(var i=a.$searchParent[r.model+"Options"],m={},d=0;d<i.length;d++){var p=i[d];m[p.value]=d}r.value.sort(function(f,h){return m[f]-m[h]}),r.value=r.value.join(","),l.push(r)}else l.push(r);continue;case"date":(r.fmt==="YYYY"||r.fmt==="YYYY-MM")&&(Array.isArray(r.value)?r.value=r.value.map(f=>ms.util.date.fmt(f,"YYYY-MM-DD")):r.value=ms.util.date.fmt(r.value,"YYYY-MM-DD")),l.push(r);continue;case"switch":r.value=!!r.value,l.push(r);continue;case"input":case"input-number":default:l.push(r)}}a.$emit("search",l)},save:function(){}}},F={class:"dialog-footer"};function T(a,l,n,s,r,i){const m=e.resolveComponent("el-button"),d=e.resolveComponent("el-option"),p=e.resolveComponent("el-select"),f=e.resolveComponent("el-form-item"),h=e.resolveComponent("el-form"),u=e.resolveComponent("el-scrollbar"),y=e.resolveComponent("el-col"),B=e.resolveComponent("el-row"),g=e.resolveComponent("el-table-column"),R=e.resolveComponent("el-input"),j=e.resolveComponent("el-switch"),U=e.resolveComponent("el-time-picker"),_=e.resolveComponent("el-date-picker"),x=e.resolveComponent("el-cascader"),A=e.resolveComponent("el-link"),H=e.resolveComponent("el-table"),K=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(m,{type:"primary",class:"el-icon-s-operation",size:"default",onClick:l[0]||(l[0]=t=>a.visible=!0)},{default:e.withCtx(()=>[e.createTextVNode("筛选")]),_:1}),e.createVNode(K,{id:"search",title:"筛选",modelValue:a.visible,"onUpdate:modelValue":l[1]||(l[1]=t=>a.visible=t),"close-on-click-modal":!1,width:"40%"},{footer:e.withCtx(()=>[e.createElementVNode("span",F,[e.createVNode(m,{type:"primary",size:"default",onClick:i.search},{default:e.withCtx(()=>[e.createTextVNode("查询")]),_:1},8,["onClick"])])]),default:e.withCtx(()=>[e.createVNode(B,null,{default:e.withCtx(()=>[e.createVNode(y,{span:24},{default:e.withCtx(()=>[e.createVNode(u,{class:"ms-scrollbar",style:{height:"100%"}},{default:e.withCtx(()=>[e.createVNode(h,{"label-width":"120px",size:"default"},{default:e.withCtx(()=>[e.createVNode(f,{label:"添加筛选条件:"},{default:e.withCtx(()=>[e.createVNode(p,{onChange:i.select},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.availableOptions,(t,o)=>(e.openBlock(),e.createBlock(d,{key:t.index,value:o,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["onChange"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(H,{size:"default","show-header":!1,data:a.list,style:{width:"100%"}},{default:e.withCtx(()=>[e.createVNode(g,{prop:"name",width:"110"}),e.createVNode(g,{width:"130"},{default:e.withCtx(t=>[t.row.type=="input"||t.row.type=="textarea"?(e.openBlock(),e.createBlock(p,{key:0,modelValue:t.row.el,"onUpdate:modelValue":o=>t.row.el=o,size:"default"},{default:e.withCtx(()=>[e.createVNode(d,{label:"等于",value:"eq"}),e.createVNode(d,{label:"包含",value:"like"}),e.createVNode(d,{label:"不包含",value:"notLike"}),e.createVNode(d,{label:"为空",value:"empty"}),e.createVNode(d,{label:"不为空",value:"notempty"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0),t.row.type=="number"?(e.openBlock(),e.createBlock(p,{key:1,modelValue:t.row.el,"onUpdate:modelValue":o=>t.row.el=o,size:"default"},{default:e.withCtx(()=>[e.createVNode(d,{label:"大于",value:"gt"}),e.createVNode(d,{label:"小于",value:"lt"}),e.createVNode(d,{label:"等于",value:"eq"}),e.createVNode(d,{label:"不等于",value:"ne"}),e.createVNode(d,{label:"大于等于",value:"gte"}),e.createVNode(d,{label:"小于等于",value:"lte"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0),t.row.type=="date"||t.row.type=="time"?(e.openBlock(),e.createBlock(p,{key:2,modelValue:t.row.el,"onUpdate:modelValue":o=>t.row.el=o,size:"default",onChange:o=>i.dateChange(t.row)},{default:e.withCtx(()=>[e.createVNode(d,{label:"大于",value:"gt"}),e.createVNode(d,{label:"等于",value:"eq"}),e.createVNode(d,{label:"不等于",value:"ne"}),e.createVNode(d,{label:"小于",value:"lt"}),e.createVNode(d,{label:"范围",value:"range"}),e.createVNode(d,{label:"为空",value:"empty"}),e.createVNode(d,{label:"不为空",value:"notempty"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):e.createCommentVNode("",!0),t.row.hasOwnProperty("multiple")||t.row.type=="switch"||t.row.type=="role"||t.row.type=="province_id"?(e.openBlock(),e.createBlock(p,{key:3,modelValue:t.row.el,"onUpdate:modelValue":o=>t.row.el=o,size:"default"},{default:e.withCtx(()=>[e.createVNode(d,{label:"等于",value:"eq"}),e.createVNode(d,{label:"为空",value:"empty"}),e.createVNode(d,{label:"不为空",value:"notempty"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0),t.row.type=="imgupload"||t.row.type=="imgdetail"?(e.openBlock(),e.createBlock(p,{key:4,modelValue:t.row.el,"onUpdate:modelValue":o=>t.row.el=o,size:"default"},{default:e.withCtx(()=>[e.createVNode(d,{label:"为空",value:"empty"}),e.createVNode(d,{label:"不为空",value:"notempty"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0)]),_:1}),e.createVNode(g,null,{default:e.withCtx(t=>[t.row.el!="empty"&&t.row.el!="notempty"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t.row.type=="input"||t.row.type=="number"||t.row.type=="textarea"?(e.openBlock(),e.createBlock(R,{key:0,style:{width:"200px"},modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o,size:"default",type:t.row.type==="number"?"number":"text"},null,8,["modelValue","onUpdate:modelValue","type"])):e.createCommentVNode("",!0),t.row.hasOwnProperty("multiple")&&t.row.type!=="cascader"?(e.openBlock(),e.createBlock(p,{key:1,style:{width:"200px"},modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o,size:"default",multiple:t.row.multiple},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.$searchParent[t.row.model+"Options"],o=>(e.openBlock(),e.createBlock(d,{key:o[t.row.key],value:o[t.row.key],label:o[t.row.title]},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","multiple"])):e.createCommentVNode("",!0),t.row.type=="switch"?(e.openBlock(),e.createBlock(j,{key:2,modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o},null,8,["modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0),t.row.type=="time"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:3},[t.row.el=="range"?(e.openBlock(),e.createBlock(U,{key:0,size:"default",clearable:"","is-range":"","value-format":"HH:mm:ss","range-separator":"至","start-placeholder":"请选择开始时间","end-placeholder":"请选择结束时间",modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o},null,8,["modelValue","onUpdate:modelValue"])):(e.openBlock(),e.createBlock(U,{key:1,size:"default",clearable:"","value-format":"HH:mm:ss",modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o},null,8,["modelValue","onUpdate:modelValue"]))],64)):e.createCommentVNode("",!0),t.row.type=="date"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:4},[t.row.fmt==="YYYY"?(e.openBlock(),e.createBlock(_,{key:0,size:"default",clearable:"","value-format":"YYYY",type:t.row.el==="range"?"yearrange":"year",modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o},null,8,["type","modelValue","onUpdate:modelValue"])):t.row.fmt==="YYYY-MM"?(e.openBlock(),e.createBlock(_,{key:1,size:"default",clearable:"","value-format":"YYYY-MM",type:t.row.el==="range"?"monthrange":"month",modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o},null,8,["type","modelValue","onUpdate:modelValue"])):t.row.fmt==="YYYY-MM-DD"?(e.openBlock(),e.createBlock(_,{key:2,size:"default",clearable:"","value-format":"YYYY-MM-DD",type:t.row.el==="range"?"daterange":"date",modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o},null,8,["type","modelValue","onUpdate:modelValue"])):(e.openBlock(),e.createBlock(_,{key:3,size:"default",clearable:"","value-format":"YYYY-MM-DD HH:mm:ss",type:t.row.el==="range"?"datetimerange":"datetime",modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o},null,8,["type","modelValue","onUpdate:modelValue"]))],64)):e.createCommentVNode("",!0),t.row.type==="province_id"||t.row.type==="cascader"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:5},[t.row.type==="province_id"?(e.openBlock(),e.createBlock(x,{key:0,modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o,props:i.$searchParent[t.row.model+"Props"]},null,8,["modelValue","onUpdate:modelValue","props"])):t.row.type==="cascader"?(e.openBlock(),e.createBlock(x,{key:1,modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o,props:i.$searchParent[t.row.model+"Props"],options:i.cascaderTreeDatas(t.row)},null,8,["modelValue","onUpdate:modelValue","props","options"])):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)]),_:1}),e.createVNode(g,{align:"center",width:"130"},{default:e.withCtx(t=>[t.$index!=a.list.length-1?(e.openBlock(),e.createBlock(p,{key:0,modelValue:t.row.action,"onUpdate:modelValue":o=>t.row.action=o,size:"default"},{default:e.withCtx(()=>[e.createVNode(d,{label:"与",value:"and"}),e.createVNode(d,{label:"或",value:"or"})]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.createCommentVNode("",!0)]),_:1}),e.createVNode(g,{align:"center",width:"60"},{default:e.withCtx(t=>[e.createVNode(A,{type:"primary",underline:!1,onClick:o=>i.delField(t.$index)},{default:e.withCtx(()=>[e.createTextVNode("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}const C=w(q,[["render",T],["__scopeId","data-v-2a385fa6"]]),P=[k,b,C],N=(a,l)=>{P.forEach(n=>{n.install=s=>{s.component(n.name,n),l&&l.debug},a.use((n.name,n))})},J={install:N};c.MsIcon=k,c.MsMdiyForm=b,c.MsSearch=C,c.default=J,c.install=N,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
