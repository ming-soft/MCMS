(function(u,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(u=typeof globalThis!="undefined"?globalThis:u||self,s(u.VueUeditorWrap={},u.Vue))})(this,function(u,s){"use strict";class v{constructor(){this.listeners={}}on(t,n){this.listeners[t]===void 0&&(this.listeners[t]={triggered:!1,requested:!1,cbs:[]}),this.listeners[t].triggered&&n(),this.listeners[t].cbs.push(n)}emit(t){this.listeners[t]&&(this.listeners[t].triggered=!0,this.listeners[t].cbs.forEach(n=>n()))}}function C(e,t){let n;const d=function(...r){n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,r)},t)};return d.cancel=function(){n!==void 0&&clearTimeout(n)},d}function p(e){return e.reduce((t,n)=>t.then(n),Promise.resolve())}function U(e){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let d=0;d<e;d++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}var w=s.defineComponent({name:"vue-ueditor-wrap",props:{editorId:String,name:String,modelValue:{type:String,default:""},config:Object,mode:{type:String,default:"observer",validator:e=>["observer","listener"].indexOf(e)!==-1},observerOptions:{type:Object,default:()=>({attributes:!0,attributeFilter:["src","style","type","name"],characterData:!0,childList:!0,subtree:!0})},observerDebounceTime:{type:Number,default:50,validator:e=>e>=20},forceInit:Boolean,destroy:{type:Boolean,default:!0},editorDependencies:{type:Array},editorDependenciesChecker:{type:Function}},emits:["update:modelValue","before-init","ready"],setup(e,{emit:t}){const n={UN_READY:"UN_READY",PENDING:"PENDING",READY:"READY"};let d=n.UN_READY,r,a,f;const m=s.ref(),O=["ueditor.config.js","ueditor.all.js"],T=()=>window.UE&&window.UE.getEditor&&window.UEDITOR_CONFIG&&Object.keys(window.UEDITOR_CONFIG).length!==0,A=s.toRef(e,"modelValue");window.$loadEventBus||(window.$loadEventBus=new v);const R=i=>new Promise((h,E)=>{if(window.$loadEventBus.on(i,h),window.$loadEventBus.listeners[i].requested===!1){window.$loadEventBus.listeners[i].requested=!0;const o=document.createElement("script");o.src=i,o.onload=()=>{window.$loadEventBus.emit(i)},o.onerror=E,document.getElementsByTagName("head")[0].appendChild(o)}}),V=i=>new Promise((h,E)=>{if(window.$loadEventBus.on(i,h),window.$loadEventBus.listeners[i].requested===!1){window.$loadEventBus.listeners[i].requested=!0;const o=document.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=i,o.onload=()=>{window.$loadEventBus.emit(i)},o.onerror=E,document.getElementsByTagName("head")[0].appendChild(o)}}),I=()=>new Promise((i,h)=>{if(e.editorDependencies&&e.editorDependenciesChecker&&e.editorDependenciesChecker()){i();return}if(!e.editorDependencies&&T()){i();return}const{jsLinks:E,cssLinks:o}=(e.editorDependencies||O).reduce((c,l)=>{var y;return/^((https?:)?\/\/)?[-a-zA-Z0-9]+(\.[-a-zA-Z0-9]+)+\//.test(l)||(l=(((y=e.config)==null?void 0:y.UEDITOR_HOME_URL)||"")+l),l.slice(-3)===".js"?c.jsLinks.push(l):l.slice(-4)===".css"&&c.cssLinks.push(l),c},{jsLinks:[],cssLinks:[]});Promise.all([Promise.all(o.map(c=>V(c))),p(E.map(c=>()=>R(c)))]).then(()=>i()).catch(h)}),D=()=>{f=r.getContent(),t("update:modelValue",f)},L=()=>{r.addListener("contentChange",D)},_=()=>{r.document.getElementById("baidu_pastebin")||(f=r.getContent(),t("update:modelValue",f))},j=()=>{a=new MutationObserver(C(_,e.observerDebounceTime)),a.observe(r.body,e.observerOptions)},g=()=>{const i=e.editorId||"editor_"+U(8);m.value.id=i,t("before-init",i),r=window.UE.getEditor(i,e.config),r.addListener("ready",()=>{d===n.READY?r.setContent(e.modelValue):(d=n.READY,t("ready",r),e.modelValue&&r.setContent(e.modelValue)),e.mode==="observer"&&window.MutationObserver?j():L()})};return s.watch(A,i=>{d===n.UN_READY?(d=n.PENDING,(e.forceInit||typeof window!="undefined")&&I().then(()=>{m.value?g():s.nextTick(()=>g())}).catch(()=>{throw new Error("[vue-ueditor-wrap] UEditor \u8D44\u6E90\u52A0\u8F7D\u5931\u8D25\uFF01\u8BF7\u68C0\u67E5\u8D44\u6E90\u662F\u5426\u5B58\u5728\uFF0CUEDITOR_HOME_URL \u662F\u5426\u914D\u7F6E\u6B63\u786E\uFF01")})):d===n.READY&&(i===f||r.setContent(i||""))},{immediate:!0}),s.onDeactivated(()=>{r&&r.removeListener("contentChange",D),a&&a.disconnect()}),s.onBeforeUnmount(()=>{a&&a.disconnect&&a.disconnect(),e.destroy&&r&&r.destroy&&r.destroy()}),()=>Vue.h("div",null,Vue.h("div",{ref:m,name:e.name}))}});const B=[w],b=e=>{B.forEach(t=>{t.install=n=>{n.component(t.name,t)},e.use((t.name,t))})};var F={install:b};u.VueUeditorWrap=w,u.default=F,u.install=b,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
